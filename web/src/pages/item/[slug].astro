---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import { loadListings } from '../../lib/loadData';
import type { GetStaticPaths } from 'astro';

export const getStaticPaths: GetStaticPaths = () => {
  const listings = loadListings();
  return listings.map(listing => ({
    params: { slug: listing.slug },
    props: { listing }
  }));
};

const { listing } = Astro.props;

if (!listing) {
  return Astro.redirect('/404');
}

const title = `${listing.show_title || listing.toyline_name} | ToyToons`;
const description = listing.description_summary 
  ? listing.description_summary.substring(0, 150) + '...'
  : `Learn about ${listing.show_title || listing.toyline_name}, a ${listing.era} animated show and toy line${listing.manufacturer ? ` by ${listing.manufacturer}` : ''}.`;
---

<Layout title={title} description={description}>
  <Header />
  
  <main style="max-width: 800px; margin: 0 auto; padding: 20px;">
    
    <!-- Breadcrumb Navigation -->
    <p style="margin-bottom: 20px; font-size: 14px;">
      <a href="/">‚Üê Back to Home</a>
    </p>
    
    <!-- Main Content Table -->
    <table style="width: 100%; border: 2px solid black; border-collapse: collapse; background: white;">
      
      <!-- Title Row -->
      <tr style="background: #f0f0f0;">
        <td colspan="2" style="border: 1px solid black; padding: 15px; text-align: center;">
          <h1 style="font-size: 24px; margin: 0; font-weight: bold;">
            {listing.show_title || listing.toyline_name}
          </h1>
          {listing.toyline_name && listing.toyline_name !== listing.show_title && (
            <p style="margin: 5px 0 0 0; font-style: italic;">
              Toy Line: {listing.toyline_name}
            </p>
          )}
        </td>
      </tr>
      
      <!-- Info Row -->
      <tr>
        <td style="border: 1px solid black; padding: 15px; width: 30%; vertical-align: top; background: #f8f8f8;">
          <h3 style="margin-top: 0; font-size: 16px;">Quick Facts</h3>
          
          {listing.era && (
            <p><strong>Era:</strong><br>{listing.era}</p>
          )}
          
          {listing.manufacturer && (
            <p><strong>Manufacturer:</strong><br>{listing.manufacturer}</p>
          )}
          
          {listing.years_aired && (
            <p><strong>Show Aired:</strong><br>{listing.years_aired}</p>
          )}
          
          {listing.years_toyline && (
            <p><strong>Toys Produced:</strong><br>{listing.years_toyline}</p>
          )}
          
          {listing.studio_network && (
            <p><strong>Studio/Network:</strong><br>{listing.studio_network}</p>
          )}
          
          {listing.country && (
            <p><strong>Country:</strong><br>{listing.country}</p>
          )}
          
          <hr style="border: none; border-top: 1px solid black; margin: 15px 0;">
          
          <h3 style="font-size: 16px;">Navigation</h3>
          <p><a href="/">üè† Home Page</a></p>
          <p><a href="/#listings">üì∫ All Shows</a></p>
          {listing.source_url && (
            <p><a href={listing.source_url} target="_blank">üîó Original Source</a></p>
          )}
          
        </td>
        
        <td style="border: 1px solid black; padding: 15px; vertical-align: top;">
          {listing.main_image_local && (
            <div style="text-align: center; margin-bottom: 20px;">
              <img 
                src={`/${listing.main_image_local}`} 
                alt={listing.show_title || 'Show image'} 
                style="max-width: 100%; max-height: 300px; border: 1px solid black;"
              />
            </div>
          )}
          
          <h2 style="margin-top: 0; font-size: 18px; border-bottom: 1px solid black; padding-bottom: 5px;">
            Description
          </h2>
          
          {listing.description_summary ? (
            <p style="line-height: 1.6; text-align: justify;">
              {listing.description_summary}
            </p>
          ) : (
            <p><em>No description available.</em></p>
          )}
          
          {listing.notable_characters.length > 0 && (
            <div style="margin-top: 30px;">
              <h2 style="font-size: 18px; border-bottom: 1px solid black; padding-bottom: 5px;">
                Notable Characters
              </h2>
              <ul style="column-count: 2; column-gap: 20px; margin-top: 15px;">
                {listing.notable_characters.map(character => (
                  <li style="margin-bottom: 5px;">‚Ä¢ {character}</li>
                ))}
              </ul>
            </div>
          )}
          
          {listing.additional_images && listing.additional_images.length > 0 && (
            <div style="margin-top: 30px;">
              <h2 style="font-size: 18px; border-bottom: 1px solid black; padding-bottom: 5px;">
                Additional Images
              </h2>
              <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px;">
                {listing.additional_images.map(image => (
                  <div style="text-align: center;">
                    <img 
                      src={`/${image.local}`} 
                      alt={image.description || 'Additional image'} 
                      style="width: 120px; height: 120px; object-fit: cover; border: 1px solid black;"
                    />
                    {image.description && (
                      <p style="font-size: 12px; margin: 5px 0 0 0; max-width: 120px;">
                        {image.description}
                      </p>
                    )}
                  </div>
                ))}
              </div>
            </div>
          )}
          
          {listing.source_title && (
            <div style="margin-top: 30px; padding: 10px; border: 1px solid #ccc; background: #ffffcc;">
              <h3 style="margin-top: 0; font-size: 14px;">Source Information</h3>
              <p style="margin: 5px 0; font-size: 13px;"><strong>Title:</strong> {listing.source_title}</p>
              {listing.source_url && (
                <p style="margin: 5px 0; font-size: 13px; word-break: break-all;">
                  <strong>URL:</strong> <a href={listing.source_url} target="_blank">{listing.source_url}</a>
                </p>
              )}
            </div>
          )}
          
        </td>
      </tr>
      
    </table>
    
    <!-- Bottom Navigation -->
    <center>
      <p style="margin: 20px 0;">
        <a href="/">¬´ Back to ToyToons Database</a>
      </p>
    </center>
    
  </main>
</Layout>

<style>
  /* Basic retro styling */
  table {
    font-size: 14px;
  }
  
  a:hover {
    background-color: #ffffcc;
  }
  
  h1, h2, h3 {
    font-family: Georgia, serif;
  }
  
  /* Focus styles for accessibility */
  a:focus {
    outline: 2px solid #0000EE;
  }
</style>